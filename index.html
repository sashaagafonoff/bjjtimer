<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BJJ Timer (TV)</title>
<style>
  :root { --bg:#000; --fg:#fff; --fight:#1db954; --rest:#ffae00; --end:#ff3b30; --muted:#9aa0a6; }
  html,body { height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
  .wrap { position:relative; display:flex; flex-direction:column; height:100%; gap:2vh; padding:2vh 3vw; overflow:hidden; }

  .topbar { display:flex; justify-content:space-between; align-items:center; font-size:2.6vh; color:var(--muted); z-index:2; }
  .stage { flex:1; display:flex; align-items:center; justify-content:center; z-index:1; }

  .ring {
    position: relative;
    width:min(70vh,80vw); height:min(70vh,80vw);
    border-radius:50%;
    border:1.2vh solid #333; box-shadow:inset 0 0 0 1.2vh #111;
    background: conic-gradient(var(--fight) 0deg, #222 0deg);
    overflow:hidden;
  }
  .ring .logo {
    position:absolute; inset:0; margin:auto; width:120%; height:auto; opacity:.85; pointer-events:none;
  }
  .ring .badge {
    position:absolute; left:0; right:0; bottom:6%;
    text-align:center; font-size:3vh; opacity:.9;
  }

  .subinfo { text-align:center; margin-top:1vh; font-size:3.5vh; color:var(--muted); z-index:2; }

  .controls { display:flex; justify-content:center; gap:2vw; flex-wrap:wrap; margin-top:1vh; z-index:2; }
  .controls button, .settings button {
    font-size:3.2vh; padding:1vh 2vw; background:#111; color:#fff; border:1px solid #333; border-radius:.8vh;
  }

  .settings { display:flex; justify-content:center; gap:4vw; flex-wrap:wrap; align-items:flex-end; margin-top:1vh; z-index:2; }
  .settings .group { text-align:center; }
  .settings .label { font-size:2.4vh; color:var(--muted); }
  .settings .value { font-size:4vh; margin:.4vh 0 1vh; }

  /* Full-screen time overlay */
  .timeOverlay {
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    pointer-events:none; z-index:3;
    font-weight:900; line-height:1; letter-spacing:.02em; font-variant-numeric:tabular-nums;
    font-size: clamp(22vh, 28vw, 60vh);
    opacity:.6;
    text-shadow: 0 0 25px rgba(0,0,0,.7), 0 0 60px rgba(0,0,0,.35);
    color:#fff; /* default white */
  }
  .fighting .timeOverlay { color: var(--fight); }
  .resting .timeOverlay { color: var(--rest); }
  .ended   .timeOverlay { color: var(--end); }

  .foot { text-align:center; font-size:2.4vh; color:var(--muted); margin-top:auto; z-index:2; }

  .prestart { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55); z-index:4; }
  .prebox { padding:3vh 5vw; border:2px solid #444; border-radius:1vh; background:#111; text-align:center; }
  .pretitle { font-size:4vh; color:#cde; margin-bottom:1vh; }
  .pretime { font-size:14vh; font-weight:800; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>OK/Enter=Start/Pause • Back/Esc=Reset • 0=Fullscreen</div>
      <div>Breaks: 1:00</div>
    </div>

    <div class="stage">
      <div class="ring" id="ring">
        <img src="Untitled.png" class="logo" alt="Logo" onerror="this.style.display='none'"/>
        <div class="badge" id="phaseBadge">Ready</div>
      </div>
    </div>

    <div class="subinfo" id="rounds">Round 1 / 5</div>

    <div class="controls">
      <button id="startPause">Start</button>
      <button id="reset">Reset</button>
      <button id="fullscreen">Fullscreen</button>
    </div>

    <div class="settings">
      <div class="group">
        <div class="label">Match Time</div>
        <div class="value" id="matchLenLbl">5:00</div>
        <button id="minusMin">−1 min</button>
        <button id="plusMin">+1 min</button>
      </div>
      <div class="group">
        <div class="label">Rounds</div>
        <div class="value" id="roundsLbl">5</div>
        <button id="minusRnd">−1</button>
        <button id="plusRnd">+1</button>
      </div>
      <div class="group">
        <div class="label">Break</div>
        <div class="value">1:00 (fixed)</div>
      </div>
    </div>

    <div class="foot">BJJ Timer • v0.5</div>
  </div>

  <!-- Giant full-screen timer -->
  <div class="timeOverlay" id="clock">05:00</div>

  <!-- Pre-start overlay -->
  <div class="prestart" id="preOverlay" aria-hidden="true">
    <div class="prebox">
      <div class="pretitle">Get Ready</div>
      <div class="pretime" id="preClock">00:10</div>
    </div>
  </div>

<script>
/* (same WebAudio + timer logic as before, shortened here for clarity) */
let audioCtx=null;function ensureAudio(){if(!audioCtx)audioCtx=new (window.AudioContext||window.webkitAudioContext)();}
function tone(freq=880,ms=200,type='sine',gain=0.22){try{ensureAudio();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type=type;o.frequency.value=freq;g.gain.value=gain;o.connect(g);g.connect(audioCtx.destination);const t=audioCtx.currentTime;o.start(t);g.gain.setValueAtTime(gain,t);g.gain.exponentialRampToValueAtTime(0.0001,t+ms/1000);o.stop(t+ms/1000+0.02);}catch{}}
function beep(){tone(1000,180,'sine',0.26);}function bell(){tone(660,250,'triangle',0.32);setTimeout(()=>tone(440,350,'sine',0.26),40);setTimeout(()=>tone(880,200,'sine',0.18),60);}

const clockEl=document.getElementById('clock'),roundsEl=document.getElementById('rounds'),badgeEl=document.getElementById('phaseBadge'),matchLenLbl=document.getElementById('matchLenLbl'),roundsLbl=document.getElementById('roundsLbl'),ringEl=document.getElementById('ring'),preOverlay=document.getElementById('preOverlay'),preClock=document.getElementById('preClock');
const btnMinus=document.getElementById('minusMin'),btnPlus=document.getElementById('plusMin'),btnMinusR=document.getElementById('minusRnd'),btnPlusR=document.getElementById('plusRnd'),btnStart=document.getElementById('startPause'),btnReset=document.getElementById('reset'),btnFS=document.getElementById('fullscreen');

const BREAK_SEC=60,PRESTART_SEC=10;let matchSec=5*60,roundsTotal=5,roundNum=1,phase='ready',remaining=matchSec,running=false,rafId=null,lastTs=null;
function fmt(sec){sec=Math.max(0,Math.floor(sec));const m=Math.floor(sec/60),s=sec%60;return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}
function ringColor(){if(phase==='pre')return '#8888ff';if(phase==='run')return remaining<=10?'#ffae00':'#1db954';if(phase==='break')return '#ffae00';if(phase==='done')return '#ff3b30';return '#222';}
function updateRing(){const total=phase==='run'?matchSec:phase==='break'?BREAK_SEC:phase==='pre'?PRESTART_SEC:1;const done=total-remaining;const pct=Math.max(0,Math.min(1,done/total));const deg=Math.floor(360*pct);ringEl.style.background=`conic-gradient(${ringColor()} ${deg}deg, #222 ${deg}deg)`;}
function updateUI(){
  clockEl.textContent=fmt(remaining);
  roundsEl.textContent=`Round ${Math.min(roundNum,roundsTotal)} / ${roundsTotal}`+(phase==='break'?'  (REST)':'');
  matchLenLbl.textContent=fmt(matchSec); roundsLbl.textContent=String(roundsTotal);
  badgeEl.textContent=phase==='pre'?'Get Ready':phase==='run'?'Fight':phase==='break'?'Rest':phase==='done'?'Finished':'Ready';

  document.body.classList.remove('fighting','resting','ended');
  if(phase==='run') document.body.classList.add('fighting');
  else if(phase==='break') document.body.classList.add('resting');
  else if(phase==='done') document.body.classList.add('ended');

  btnStart.textContent=running?'Pause':(phase==='done'?'Restart':'Start');
  preOverlay.style.display=(phase==='pre')?'flex':'none';
  preClock.textContent=fmt(remaining);
  updateRing();
}

/* flow, loop, controls same as before ... */
</script>
</body>
</html>
